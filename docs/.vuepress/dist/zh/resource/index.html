<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SQlè¯­å¥å¤§å…¨ | æ¡ƒå­ğŸ‘Â·Blog</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="é™¶å¯èˆªçš„åšå®¢">
    
    <link rel="preload" href="/assets/css/0.styles.895620e1.css" as="style"><link rel="preload" href="/assets/js/app.5ba1fee4.js" as="script"><link rel="preload" href="/assets/js/3.2a10d64a.js" as="script"><link rel="preload" href="/assets/js/21.41a6462b.js" as="script"><link rel="prefetch" href="/assets/js/10.38b5f51f.js"><link rel="prefetch" href="/assets/js/11.a84b5578.js"><link rel="prefetch" href="/assets/js/12.4f4b0b31.js"><link rel="prefetch" href="/assets/js/13.6dd7c9d7.js"><link rel="prefetch" href="/assets/js/14.22861748.js"><link rel="prefetch" href="/assets/js/15.200b9fe9.js"><link rel="prefetch" href="/assets/js/16.ef15caa2.js"><link rel="prefetch" href="/assets/js/17.480df997.js"><link rel="prefetch" href="/assets/js/18.a8e75760.js"><link rel="prefetch" href="/assets/js/19.bd084016.js"><link rel="prefetch" href="/assets/js/20.6981a195.js"><link rel="prefetch" href="/assets/js/22.b58f10a8.js"><link rel="prefetch" href="/assets/js/23.5c129feb.js"><link rel="prefetch" href="/assets/js/24.4887b391.js"><link rel="prefetch" href="/assets/js/4.35efff24.js"><link rel="prefetch" href="/assets/js/5.7a14d7a5.js"><link rel="prefetch" href="/assets/js/6.5772e90d.js"><link rel="prefetch" href="/assets/js/7.7e1c1509.js"><link rel="prefetch" href="/assets/js/8.dc3922b5.js"><link rel="prefetch" href="/assets/js/9.de9f3ee1.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.e78d7987.js">
    <link rel="stylesheet" href="/assets/css/0.styles.895620e1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">æ¡ƒå­ğŸ‘Â·Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/guide/" class="nav-link">
  å‰1ç«¯
</a></div><div class="nav-item"><a href="/zh/resource/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  åç«¯
</a></div><div class="nav-item"><a href="https://github.com/travis-green" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://developers.weixin.qq.com/community/personal/oCJUsw0kGA9yI6HZLQmlfwr5XKKA" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å¾®ä¿¡ç¤¾åŒº
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://forum.alipay.com/developer/1100222" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ”¯ä»˜å®ç¤¾åŒº
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh/guide/" class="nav-link">
  å‰1ç«¯
</a></div><div class="nav-item"><a href="/zh/resource/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  åç«¯
</a></div><div class="nav-item"><a href="https://github.com/travis-green" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://developers.weixin.qq.com/community/personal/oCJUsw0kGA9yI6HZLQmlfwr5XKKA" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å¾®ä¿¡ç¤¾åŒº
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://forum.alipay.com/developer/1100222" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ”¯ä»˜å®ç¤¾åŒº
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/zh/resource/" aria-current="page" class="active sidebar-link">SQlè¯­å¥å¤§å…¨</a></li><li><a href="/zh/resource/server.html" class="sidebar-link">ElasticSearch</a></li><li><a href="/zh/resource/sql.html" class="sidebar-link">æœ€ç®€å•çš„å›¾çµæµ‹è¯•-éªŒè¯ç </a></li><li><a href="/zh/resource/http2.html" class="sidebar-link">Http 2.0 æ–°å¢äº†å“ªäº›ç‰¹æ€§</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="sqlè¯­å¥å¤§å…¨"><a href="#sqlè¯­å¥å¤§å…¨" class="header-anchor">#</a> SQlè¯­å¥å¤§å…¨</h1> <hr> <p>1ã€è¯´æ˜ï¼šåˆ›å»ºæ•°æ®åº“</p> <div class="language- extra-class"><pre><code>CREATE DATABASE database-name
</code></pre></div><p>2ã€è¯´æ˜ï¼šåˆ é™¤æ•°æ®åº“</p> <div class="language- extra-class"><pre><code>drop database dbname
</code></pre></div><p>3ã€è¯´æ˜ï¼šå¤‡ä»½sql server
--- åˆ›å»º å¤‡ä»½æ•°æ®çš„ device</p> <div class="language- extra-class"><pre><code>USE master
EXEC sp_addumpdevice 'disk', 'testBack', 'c:\mssql7backup\MyNwind_1.dat'
</code></pre></div><p>--- å¼€å§‹ å¤‡ä»½</p> <div class="language- extra-class"><pre><code>BACKUP DATABASE pubs TO testBack
</code></pre></div><p>4ã€è¯´æ˜ï¼šåˆ›å»ºæ–°è¡¨</p> <div class="language- extra-class"><pre><code>create table tabname(col1 type1 [not null] [primary key],col2 type2 [not null],..)
</code></pre></div><p>æ ¹æ®å·²æœ‰çš„è¡¨åˆ›å»ºæ–°è¡¨ï¼š</p> <div class="language- extra-class"><pre><code>Aï¼šcreate table tab_new like tab_old (ä½¿ç”¨æ—§è¡¨åˆ›å»ºæ–°è¡¨)
Bï¼šcreate table tab_new as select col1,col2â€¦ from tab_old definition only
</code></pre></div><p>5ã€è¯´æ˜ï¼šåˆ é™¤æ–°è¡¨</p> <div class="language- extra-class"><pre><code>drop table tabname
</code></pre></div><p>6ã€è¯´æ˜ï¼šå¢åŠ ä¸€ä¸ªåˆ—</p> <div class="language- extra-class"><pre><code>Alter table tabname add column col type
</code></pre></div><p>æ³¨ï¼šåˆ—å¢åŠ åå°†ä¸èƒ½åˆ é™¤ã€‚DB2ä¸­åˆ—åŠ ä¸Šåæ•°æ®ç±»å‹ä¹Ÿä¸èƒ½æ”¹å˜ï¼Œå”¯ä¸€èƒ½æ”¹å˜çš„æ˜¯å¢åŠ varcharç±»å‹çš„é•¿åº¦ã€‚</p> <p>7ã€è¯´æ˜ï¼šæ·»åŠ ä¸»é”®ï¼š</p> <div class="language- extra-class"><pre><code> Alter table tabname add primary key(col)
</code></pre></div><p>è¯´æ˜ï¼šåˆ é™¤ä¸»é”®ï¼š</p> <div class="language- extra-class"><pre><code>Alter table tabname drop primary key(col)
</code></pre></div><p>8ã€è¯´æ˜ï¼šåˆ›å»ºç´¢å¼•ï¼š</p> <div class="language- extra-class"><pre><code>create [unique] index idxname on tabname(colâ€¦.)
</code></pre></div><p>åˆ é™¤ç´¢å¼•ï¼š</p> <div class="language- extra-class"><pre><code>drop index idxname
</code></pre></div><p>æ³¨ï¼šç´¢å¼•æ˜¯ä¸å¯æ›´æ”¹çš„ï¼Œæƒ³æ›´æ”¹å¿…é¡»åˆ é™¤é‡æ–°å»ºã€‚
9ã€è¯´æ˜ï¼šåˆ›å»ºè§†å›¾ï¼š</p> <div class="language- extra-class"><pre><code>create view viewname as select statement
</code></pre></div><p>åˆ é™¤è§†å›¾ï¼š</p> <div class="language- extra-class"><pre><code>drop view viewname
</code></pre></div><p>10ã€è¯´æ˜ï¼šå‡ ä¸ªç®€å•çš„åŸºæœ¬çš„sqlè¯­å¥
é€‰æ‹©ï¼š</p> <div class="language- extra-class"><pre><code>select * from table1 where èŒƒå›´
</code></pre></div><p>æ’å…¥ï¼š</p> <div class="language- extra-class"><pre><code>insert into table1(field1,field2) values(value1,value2)
</code></pre></div><p>åˆ é™¤ï¼š</p> <div class="language- extra-class"><pre><code>delete from table1 where èŒƒå›´
</code></pre></div><p>æ›´æ–°ï¼š</p> <div class="language- extra-class"><pre><code>update table1 set field1=value1 where èŒƒå›´
</code></pre></div><p>æŸ¥æ‰¾ï¼š</p> <div class="language- extra-class"><pre><code>select * from table1 where field1 like â€™%value1%â€™---likeçš„è¯­æ³•å¾ˆç²¾å¦™ï¼ŒæŸ¥èµ„æ–™!
</code></pre></div><p>æ’åºï¼š</p> <div class="language- extra-class"><pre><code>select * from table1 order by field1,field2 [desc]
</code></pre></div><p>æ€»æ•°ï¼š</p> <div class="language- extra-class"><pre><code>select count as totalcount from table1
</code></pre></div><p>æ±‚å’Œï¼š</p> <div class="language- extra-class"><pre><code>select sum(field1) as sumvalue from table1
</code></pre></div><p>å¹³å‡ï¼š</p> <div class="language- extra-class"><pre><code>select avg(field1) as avgvalue from table1
</code></pre></div><p>æœ€å¤§ï¼š</p> <div class="language- extra-class"><pre><code>select max(field1) as maxvalue from table1
</code></pre></div><p>æœ€å°ï¼š</p> <div class="language- extra-class"><pre><code>select min(field1) as minvalue from table1
</code></pre></div><p>11ã€è¯´æ˜ï¼šå‡ ä¸ªé«˜çº§æŸ¥è¯¢è¿ç®—è¯
Aï¼š UNION è¿ç®—ç¬¦
<strong>UNION è¿ç®—ç¬¦é€šè¿‡ç»„åˆå…¶ä»–ä¸¤ä¸ªç»“æœè¡¨ï¼ˆä¾‹å¦‚ TABLE1 å’Œ TABLE2ï¼‰å¹¶æ¶ˆå»è¡¨ä¸­ä»»ä½•é‡å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨ã€‚å½“ ALL éš UNION ä¸€èµ·ä½¿ç”¨æ—¶ï¼ˆå³ UNION ALLï¼‰ï¼Œä¸æ¶ˆé™¤é‡å¤è¡Œã€‚ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ´¾ç”Ÿè¡¨çš„æ¯ä¸€è¡Œä¸æ˜¯æ¥è‡ª TABLE1 å°±æ˜¯æ¥è‡ª TABLE2ã€‚</strong>
Bï¼š EXCEPT è¿ç®—ç¬¦
<strong>EXCEPT è¿ç®—ç¬¦é€šè¿‡åŒ…æ‹¬æ‰€æœ‰åœ¨ TABLE1 ä¸­ä½†ä¸åœ¨ TABLE2 ä¸­çš„è¡Œå¹¶æ¶ˆé™¤æ‰€æœ‰é‡å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨ã€‚å½“ ALL éš EXCEPT ä¸€èµ·ä½¿ç”¨æ—¶ (EXCEPT ALL)ï¼Œä¸æ¶ˆé™¤é‡å¤è¡Œã€‚</strong>
Cï¼š INTERSECT è¿ç®—ç¬¦
<strong>INTERSECT è¿ç®—ç¬¦é€šè¿‡åªåŒ…æ‹¬ TABLE1 å’Œ TABLE2 ä¸­éƒ½æœ‰çš„è¡Œå¹¶æ¶ˆé™¤æ‰€æœ‰é‡å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨ã€‚å½“ ALL éš INTERSECT ä¸€èµ·ä½¿ç”¨æ—¶ (INTERSECT ALL)ï¼Œä¸æ¶ˆé™¤é‡å¤è¡Œã€‚</strong>
æ³¨ï¼šä½¿ç”¨è¿ç®—è¯çš„å‡ ä¸ªæŸ¥è¯¢ç»“æœè¡Œå¿…é¡»æ˜¯ä¸€è‡´çš„ã€‚
12ã€è¯´æ˜ï¼šä½¿ç”¨å¤–è¿æ¥
Aã€left ï¼ˆouterï¼‰ joinï¼š
<strong>å·¦å¤–è¿æ¥ï¼ˆå·¦è¿æ¥ï¼‰ï¼šç»“æœé›†å‡ åŒ…æ‹¬è¿æ¥è¡¨çš„åŒ¹é…è¡Œï¼Œä¹ŸåŒ…æ‹¬å·¦è¿æ¥è¡¨çš„æ‰€æœ‰è¡Œã€‚</strong>
SQL:</p> <div class="language- extra-class"><pre><code>select a.a, a.b, a.c, b.c, b.d, b.f from a LEFT OUT JOIN b ON a.a = b.c
</code></pre></div><p>Bï¼šright ï¼ˆouterï¼‰ join:
<strong>å³å¤–è¿æ¥(å³è¿æ¥)ï¼šç»“æœé›†æ—¢åŒ…æ‹¬è¿æ¥è¡¨çš„åŒ¹é…è¿æ¥è¡Œï¼Œä¹ŸåŒ…æ‹¬å³è¿æ¥è¡¨çš„æ‰€æœ‰è¡Œã€‚</strong>
Cï¼šfull/cross ï¼ˆouterï¼‰ joinï¼š
<strong>å…¨å¤–è¿æ¥ï¼šä¸ä»…åŒ…æ‹¬ç¬¦å·è¿æ¥è¡¨çš„åŒ¹é…è¡Œï¼Œè¿˜åŒ…æ‹¬ä¸¤ä¸ªè¿æ¥è¡¨ä¸­çš„æ‰€æœ‰è®°å½•ã€‚</strong>
12ã€åˆ†ç»„:Group by:
<strong>ä¸€å¼ è¡¨ï¼Œä¸€æ—¦åˆ†ç»„å®Œæˆåï¼ŒæŸ¥è¯¢ååªèƒ½å¾—åˆ°ç»„ç›¸å…³çš„ä¿¡æ¯ã€‚
ç»„ç›¸å…³çš„ä¿¡æ¯ï¼šï¼ˆç»Ÿè®¡ä¿¡æ¯ï¼‰ count,sum,max,min,avg  åˆ†ç»„çš„æ ‡å‡†)
åœ¨SQLServerä¸­åˆ†ç»„æ—¶ï¼šä¸èƒ½ä»¥text,ntext,imageç±»å‹çš„å­—æ®µä½œä¸ºåˆ†ç»„ä¾æ®
åœ¨selecteç»Ÿè®¡å‡½æ•°ä¸­çš„å­—æ®µï¼Œä¸èƒ½å’Œæ™®é€šçš„å­—æ®µæ”¾åœ¨ä¸€èµ·ï¼›</strong>
13ã€å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œï¼š
<strong>åˆ†ç¦»æ•°æ®åº“ï¼š sp_detach_db; é™„åŠ æ•°æ®åº“ï¼šsp_attach_db åæ¥è¡¨æ˜ï¼Œé™„åŠ éœ€è¦å®Œæ•´çš„è·¯å¾„å</strong>
14.å¦‚ä½•ä¿®æ”¹æ•°æ®åº“çš„åç§°:</p> <div class="language- extra-class"><pre><code>sp_renamedb 'old_name', 'new_name'
</code></pre></div><p>äºŒã€æå‡
1ã€è¯´æ˜ï¼šå¤åˆ¶è¡¨(åªå¤åˆ¶ç»“æ„,æºè¡¨åï¼ša æ–°è¡¨åï¼šb) (Accesså¯ç”¨)
æ³•ä¸€ï¼š</p> <div class="language- extra-class"><pre><code>select * into b from a where 1&lt;&gt;1ï¼ˆä»…ç”¨äºSQlServerï¼‰
</code></pre></div><p>æ³•äºŒï¼š</p> <div class="language- extra-class"><pre><code>select top 0 * into b from a
</code></pre></div><p>2ã€è¯´æ˜ï¼šæ‹·è´è¡¨(æ‹·è´æ•°æ®,æºè¡¨åï¼ša ç›®æ ‡è¡¨åï¼šb) (Accesså¯ç”¨)</p> <div class="language- extra-class"><pre><code>insert into b(a, b, c) select d,e,f from b;
</code></pre></div><p>3ã€è¯´æ˜ï¼šè·¨æ•°æ®åº“ä¹‹é—´è¡¨çš„æ‹·è´(å…·ä½“æ•°æ®ä½¿ç”¨ç»å¯¹è·¯å¾„) (Accesså¯ç”¨)</p> <div class="language- extra-class"><pre><code>insert into b(a, b, c) select d,e,f from b in â€˜å…·ä½“æ•°æ®åº“â€™ where æ¡ä»¶
</code></pre></div><p>ä¾‹å­ï¼š</p> <div class="language- extra-class"><pre><code>..from b in '&quot;&amp;Server.MapPath(&quot;.&quot;)&amp;&quot;\data.mdb&quot; &amp;&quot;' where..
</code></pre></div><p>4ã€è¯´æ˜ï¼šå­æŸ¥è¯¢(è¡¨å1ï¼ša è¡¨å2ï¼šb)</p> <div class="language- extra-class"><pre><code>select a,b,c from a where a IN (select d from b ) æˆ–è€…: select a,b,c from a where a IN (1,2,3)
</code></pre></div><p>5ã€è¯´æ˜ï¼šæ˜¾ç¤ºæ–‡ç« ã€æäº¤äººå’Œæœ€åå›å¤æ—¶é—´</p> <div class="language- extra-class"><pre><code>select a.title,a.username,b.adddate from table a,(select max(adddate) adddate from table where table.title=a.title) b
</code></pre></div><p>6ã€è¯´æ˜ï¼šå¤–è¿æ¥æŸ¥è¯¢(è¡¨å1ï¼ša è¡¨å2ï¼šb)</p> <div class="language- extra-class"><pre><code>select a.a, a.b, a.c, b.c, b.d, b.f from a LEFT OUT JOIN b ON a.a = b.c
</code></pre></div><p>7ã€è¯´æ˜ï¼šåœ¨çº¿è§†å›¾æŸ¥è¯¢(è¡¨å1ï¼ša )</p> <div class="language- extra-class"><pre><code>select * from (SELECT a,b,c FROM a) T where t.a &gt; 1;
</code></pre></div><p>8ã€è¯´æ˜ï¼šbetweençš„ç”¨æ³•,betweené™åˆ¶æŸ¥è¯¢æ•°æ®èŒƒå›´æ—¶åŒ…æ‹¬äº†è¾¹ç•Œå€¼,not betweenä¸åŒ…æ‹¬</p> <div class="language- extra-class"><pre><code>select * from table1 where time between time1 and time2
select a,b,c, from table1 where a not between æ•°å€¼1 and æ•°å€¼2
</code></pre></div><p>9ã€è¯´æ˜ï¼šin çš„ä½¿ç”¨æ–¹æ³•</p> <div class="language- extra-class"><pre><code>select * from table1 where a [not] in (â€˜å€¼1â€™,â€™å€¼2â€™,â€™å€¼4â€™,â€™å€¼6â€™)
</code></pre></div><p>10ã€è¯´æ˜ï¼šä¸¤å¼ å…³è”è¡¨ï¼Œåˆ é™¤ä¸»è¡¨ä¸­å·²ç»åœ¨å‰¯è¡¨ä¸­æ²¡æœ‰çš„ä¿¡æ¯</p> <div class="language- extra-class"><pre><code>delete from table1 where not exists ( select * from table2 where table1.field1=table2.field1 )
</code></pre></div><p>11ã€è¯´æ˜ï¼šå››è¡¨è”æŸ¥é—®é¢˜ï¼š</p> <div class="language- extra-class"><pre><code>select * from a left inner join b on a.a=b.b right inner join c on a.a=c.c inner join d on a.a=d.d where .....
</code></pre></div><p>12ã€è¯´æ˜ï¼šæ—¥ç¨‹å®‰æ’æå‰äº”åˆ†é’Ÿæé†’</p> <div class="language- extra-class"><pre><code>SQL: select * from æ—¥ç¨‹å®‰æ’ where datediff('minute',få¼€å§‹æ—¶é—´,getdate())&gt;5
</code></pre></div><p>13ã€è¯´æ˜ï¼šä¸€æ¡sql è¯­å¥æå®šæ•°æ®åº“åˆ†é¡µ</p> <div class="language- extra-class"><pre><code>select top 10 b.* from (select top 20 ä¸»é”®å­—æ®µ,æ’åºå­—æ®µ from è¡¨å order by æ’åºå­—æ®µ desc) a,è¡¨å b where b.ä¸»é”®å­—æ®µ = a.ä¸»é”®å­—æ®µ order by a.æ’åºå­—æ®µ
</code></pre></div><p>å…·ä½“å®ç°ï¼š
å…³äºæ•°æ®åº“åˆ†é¡µï¼š</p> <div class="language- extra-class"><pre><code> declare @start int,@end int
  @sql  nvarchar(600)
  set @sql=â€™select topâ€™+str(@end-@start+1)+â€™+from T where rid not in(select topâ€™+str(@str-1)+â€™Rid from T where Rid&gt;-1)â€™
  exec sp_executesql @sql
</code></pre></div><p>æ³¨æ„ï¼šåœ¨topåä¸èƒ½ç›´æ¥è·Ÿä¸€ä¸ªå˜é‡ï¼Œæ‰€ä»¥åœ¨å®é™…åº”ç”¨ä¸­åªæœ‰è¿™æ ·çš„è¿›è¡Œç‰¹æ®Šçš„å¤„ç†ã€‚Ridä¸ºä¸€ä¸ªæ ‡è¯†åˆ—ï¼Œå¦‚æœtopåè¿˜æœ‰å…·ä½“çš„å­—æ®µï¼Œè¿™æ ·åšæ˜¯éå¸¸æœ‰å¥½å¤„çš„ã€‚å› ä¸ºè¿™æ ·å¯ä»¥é¿å… topçš„å­—æ®µå¦‚æœæ˜¯é€»è¾‘ç´¢å¼•çš„ï¼ŒæŸ¥è¯¢çš„ç»“æœåå®é™…è¡¨ä¸­çš„ä¸ä¸€è‡´ï¼ˆé€»è¾‘ç´¢å¼•ä¸­çš„æ•°æ®æœ‰å¯èƒ½å’Œæ•°æ®è¡¨ä¸­çš„ä¸ä¸€è‡´ï¼Œè€ŒæŸ¥è¯¢æ—¶å¦‚æœå¤„åœ¨ç´¢å¼•åˆ™é¦–å…ˆæŸ¥è¯¢ç´¢å¼•ï¼‰
14ã€è¯´æ˜ï¼šå‰10æ¡è®°å½•</p> <div class="language- extra-class"><pre><code>select top 10 * form table1 where èŒƒå›´
</code></pre></div><p>15ã€è¯´æ˜ï¼šé€‰æ‹©åœ¨æ¯ä¸€ç»„bå€¼ç›¸åŒçš„æ•°æ®ä¸­å¯¹åº”çš„aæœ€å¤§çš„è®°å½•çš„æ‰€æœ‰ä¿¡æ¯(ç±»ä¼¼è¿™æ ·çš„ç”¨æ³•å¯ä»¥ç”¨äºè®ºå›æ¯æœˆæ’è¡Œæ¦œ,æ¯æœˆçƒ­é”€äº§å“åˆ†æ,æŒ‰ç§‘ç›®æˆç»©æ’å,ç­‰ç­‰.)</p> <div class="language- extra-class"><pre><code>select a,b,c from tablename ta where a=(select max(a) from tablename tb where tb.b=ta.b)
</code></pre></div><p>16ã€è¯´æ˜ï¼šåŒ…æ‹¬æ‰€æœ‰åœ¨ TableA ä¸­ä½†ä¸åœ¨ TableBå’ŒTableC ä¸­çš„è¡Œå¹¶æ¶ˆé™¤æ‰€æœ‰é‡å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨</p> <div class="language- extra-class"><pre><code>(select a from tableA ) except (select a from tableB) except (select a from tableC)
</code></pre></div><p>17ã€è¯´æ˜ï¼šéšæœºå–å‡º10æ¡æ•°æ®</p> <div class="language- extra-class"><pre><code>select top 10 * from tablename order by newid()
</code></pre></div><p>18ã€è¯´æ˜ï¼šéšæœºé€‰æ‹©è®°å½•</p> <div class="language- extra-class"><pre><code>select newid()
</code></pre></div><p>19ã€è¯´æ˜ï¼šåˆ é™¤é‡å¤è®°å½•</p> <div class="language- extra-class"><pre><code>1),delete from tablename where id not in (select max(id) from tablename group by col1,col2,...)
2),select distinct * into temp from tablename
  delete from tablename
  insert into tablename select * from temp
</code></pre></div><p>è¯„ä»·ï¼š è¿™ç§æ“ä½œç‰µè¿å¤§é‡çš„æ•°æ®çš„ç§»åŠ¨ï¼Œè¿™ç§åšæ³•ä¸é€‚åˆå¤§å®¹é‡ä½†æ•°æ®æ“ä½œ
3),ä¾‹å¦‚ï¼šåœ¨ä¸€ä¸ªå¤–éƒ¨è¡¨ä¸­å¯¼å…¥æ•°æ®ï¼Œç”±äºæŸäº›åŸå› ç¬¬ä¸€æ¬¡åªå¯¼å…¥äº†ä¸€éƒ¨åˆ†ï¼Œä½†å¾ˆéš¾åˆ¤æ–­å…·ä½“ä½ç½®ï¼Œè¿™æ ·åªæœ‰åœ¨ä¸‹ä¸€æ¬¡å…¨éƒ¨å¯¼å…¥ï¼Œè¿™æ ·ä¹Ÿå°±äº§ç”Ÿå¥½å¤šé‡å¤çš„å­—æ®µï¼Œæ€æ ·åˆ é™¤é‡å¤å­—æ®µ</p> <div class="language- extra-class"><pre><code>alter table tablename
</code></pre></div><p>--æ·»åŠ ä¸€ä¸ªè‡ªå¢åˆ—</p> <div class="language- extra-class"><pre><code>add  column_b int identity(1,1)
 delete from tablename where column_b not in(
select max(column_b)  from tablename group by column1,column2,...)
alter table tablename drop column column_b
</code></pre></div><p>20ã€è¯´æ˜ï¼šåˆ—å‡ºæ•°æ®åº“é‡Œæ‰€æœ‰çš„è¡¨å</p> <div class="language- extra-class"><pre><code>select name from sysobjects where type='U' // Uä»£è¡¨ç”¨æˆ·
</code></pre></div><p>21ã€è¯´æ˜ï¼šåˆ—å‡ºè¡¨é‡Œçš„æ‰€æœ‰çš„åˆ—å</p> <div class="language- extra-class"><pre><code>select name from syscolumns where id=object_id('TableName')
</code></pre></div><p>22ã€è¯´æ˜ï¼šåˆ—ç¤º<strong>typeã€venderã€pcs</strong>å­—æ®µï¼Œä»¥typeå­—æ®µæ’åˆ—ï¼Œcaseå¯ä»¥æ–¹ä¾¿åœ°å®ç°å¤šé‡é€‰æ‹©ï¼Œç±»ä¼¼select ä¸­çš„caseã€‚</p> <div class="language- extra-class"><pre><code>select type,sum(case vender when 'A' then pcs else 0 end),sum(case vender when 'C' then pcs else 0 end),sum(case vender when 'B' then pcs else 0 end) FROM tablename group by type
</code></pre></div><p>æ˜¾ç¤ºç»“æœï¼š</p> <blockquote><p>type vender pcs
ç”µè„‘ A 1
ç”µè„‘ A 1
å…‰ç›˜ B 2
å…‰ç›˜ A 2
æ‰‹æœº B 3
æ‰‹æœº C 3</p></blockquote> <p>23ã€è¯´æ˜ï¼šåˆå§‹åŒ–è¡¨table1</p> <div class="language- extra-class"><pre><code>TRUNCATE TABLE table1
</code></pre></div><p>24ã€è¯´æ˜ï¼šé€‰æ‹©ä»10åˆ°15çš„è®°å½•</p> <div class="language- extra-class"><pre><code>select top 5 * from (select top 15 * from table order by id asc) table_åˆ«å order by id desc
</code></pre></div><p>ä¸‰ã€æŠ€å·§
1ã€1=1ï¼Œ1=2çš„ä½¿ç”¨ï¼Œåœ¨SQLè¯­å¥ç»„åˆæ—¶ç”¨çš„è¾ƒå¤š
â€œwhere 1=1â€ æ˜¯è¡¨ç¤ºé€‰æ‹©å…¨éƒ¨    â€œwhere 1=2â€å…¨éƒ¨ä¸é€‰ï¼Œ
å¦‚ï¼š</p> <div class="language- extra-class"><pre><code>if @strWhere !=''
begin
set @strSQL = 'select count(*) as Total from [' + @tblName + '] where ' + @strWhere
end
else
begin
set @strSQL = 'select count(*) as Total from [' + @tblName + ']'
end
</code></pre></div><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥å†™æˆ
é”™è¯¯ï¼æœªæ‰¾åˆ°ç›®å½•é¡¹ã€‚</p> <div class="language- extra-class"><pre><code>set @strSQL = 'select count(*) as Total from [' + @tblName + '] where 1=1 å®‰å®š '+ @strWhere 
</code></pre></div><p>2ã€æ”¶ç¼©æ•°æ®åº“
--é‡å»ºç´¢å¼•</p> <div class="language- extra-class"><pre><code>DBCC REINDEX
DBCC INDEXDEFRAG
</code></pre></div><p>--æ”¶ç¼©æ•°æ®å’Œæ—¥å¿—</p> <div class="language- extra-class"><pre><code>DBCC SHRINKDB
DBCC SHRINKFILE
</code></pre></div><p>3ã€å‹ç¼©æ•°æ®åº“</p> <div class="language- extra-class"><pre><code>dbcc shrinkdatabase(dbname)
</code></pre></div><p>4ã€è½¬ç§»æ•°æ®åº“ç»™æ–°ç”¨æˆ·ä»¥å·²å­˜åœ¨ç”¨æˆ·æƒé™</p> <div class="language- extra-class"><pre><code>exec sp_change_users_login 'update_one','newname','oldname'
go
</code></pre></div><p>5ã€æ£€æŸ¥å¤‡ä»½é›†</p> <div class="language- extra-class"><pre><code>RESTORE VERIFYONLY from disk='E:\dvbbs.bak'
</code></pre></div><p>6ã€ä¿®å¤æ•°æ®åº“</p> <div class="language- extra-class"><pre><code>ALTER DATABASE [dvbbs] SET SINGLE_USER
GO
DBCC CHECKDB('dvbbs',repair_allow_data_loss) WITH TABLOCK
GO
ALTER DATABASE [dvbbs] SET MULTI_USER
GO
</code></pre></div><p>7ã€æ—¥å¿—æ¸…é™¤</p> <div class="language- extra-class"><pre><code>SET NOCOUNT ON
DECLARE @LogicalFileName sysname,
 @MaxMinutes INT,
 @NewSize INT
 
USE tablename -- è¦æ“ä½œçš„æ•°æ®åº“å
SELECT  @LogicalFileName = 'tablename_log', -- æ—¥å¿—æ–‡ä»¶å
@MaxMinutes = 10, -- Limit on time allowed to wrap log.
 @NewSize = 1  -- ä½ æƒ³è®¾å®šçš„æ—¥å¿—æ–‡ä»¶çš„å¤§å°(M)
Setup / initialize
DECLARE @OriginalSize int
SELECT @OriginalSize = size
 FROM sysfiles
 WHERE name = @LogicalFileName
SELECT 'Original Size of ' + db_name() + ' LOG is ' +
 CONVERT(VARCHAR(30),@OriginalSize) + ' 8K pages or ' +
 CONVERT(VARCHAR(30),(@OriginalSize*8/1024)) + 'MB'
 FROM sysfiles
 WHERE name = @LogicalFileName
CREATE TABLE DummyTrans
 (DummyColumn char (8000) not null)
 
DECLARE @Counter    INT,
 @StartTime DATETIME,
 @TruncLog   VARCHAR(255)
SELECT @StartTime = GETDATE(),
 @TruncLog = 'BACKUP LOG ' + db_name() + ' WITH TRUNCATE_ONLY'
DBCC SHRINKFILE (@LogicalFileName, @NewSize)
EXEC (@TruncLog)
-- Wrap the log if necessary.
WHILE @MaxMinutes &gt; DATEDIFF (mi, @StartTime, GETDATE()) -- time has not expired
 AND @OriginalSize = (SELECT size FROM sysfiles WHERE name = @LogicalFileName) 
 AND (@OriginalSize * 8 /1024) &gt; @NewSize 
 BEGIN -- Outer loop.
SELECT @Counter = 0
 WHILE   ((@Counter &lt; @OriginalSize / 16) AND (@Counter &lt; 50000))
 BEGIN -- update
 INSERT DummyTrans VALUES ('Fill Log') DELETE DummyTrans
 SELECT @Counter = @Counter + 1
 END
 EXEC (@TruncLog) 
 END
SELECT 'Final Size of ' + db_name() + ' LOG is ' +
 CONVERT(VARCHAR(30),size) + ' 8K pages or ' +
 CONVERT(VARCHAR(30),(size*8/1024)) + 'MB'
 FROM sysfiles
 WHERE name = @LogicalFileName
DROP TABLE DummyTrans
SET NOCOUNT OFF
</code></pre></div><p>8ã€è¯´æ˜ï¼šæ›´æ”¹æŸä¸ªè¡¨</p> <div class="language- extra-class"><pre><code>exec sp_changeobjectowner 'tablename','dbo'
</code></pre></div><p>9ã€å­˜å‚¨æ›´æ”¹å…¨éƒ¨è¡¨</p> <div class="language- extra-class"><pre><code>CREATE PROCEDURE dbo.User_ChangeObjectOwnerBatch
@OldOwner as NVARCHAR(128),
@NewOwner as NVARCHAR(128)
AS
DECLARE @Name    as NVARCHAR(128)
DECLARE @Owner   as NVARCHAR(128)
DECLARE @OwnerName   as NVARCHAR(128)
DECLARE curObject CURSOR FOR
select 'Name'    = name,
   'Owner'    = user_name(uid)
from sysobjects
where user_name(uid)=@OldOwner
order by name
OPEN   curObject
FETCH NEXT FROM curObject INTO @Name, @Owner
WHILE(@@FETCH_STATUS=0)
BEGIN   
if @Owner=@OldOwner
begin
   set @OwnerName = @OldOwner + '.' + rtrim(@Name)
   exec sp_changeobjectowner @OwnerName, @NewOwner
end
-- select @name,@NewOwner,@OldOwner
FETCH NEXT FROM curObject INTO @Name, @Owner
END
close curObject
deallocate curObject
GO
</code></pre></div><p>10ã€SQL SERVERä¸­ç›´æ¥å¾ªç¯å†™å…¥æ•°æ®</p> <div class="language- extra-class"><pre><code>declare @i int
set @i=1
while @i&lt;30
begin
    insert into test (userid) values(@i)
    set @i=@i+1
end
</code></pre></div><p>æ¡ˆä¾‹ï¼š
æœ‰å¦‚ä¸‹è¡¨ï¼Œè¦æ±‚å°±è£±ä¸­æ‰€æœ‰æ²’æœ‰åŠæ ¼çš„æˆç¸¾ï¼Œåœ¨æ¯æ¬¡å¢é•·0.1çš„åŸºç¤ä¸Šï¼Œä½¿ä»–å€‘å‰›å¥½åŠæ ¼:</p> <div class="language- extra-class"><pre><code> Name     score
 Zhangshan 80
 Lishi       59
 Wangwu      50
 Songquan 69
while((select min(score) from tb_table)&lt;60)
begin
update tb_table set score =score*1.01
where score&lt;60
if  (select min(score) from tb_table)&gt;60
  break
 else
    continue
end
</code></pre></div><p>æ•°æ®å¼€å‘-ç»å…¸</p> <p>1.æŒ‰å§“æ°ç¬”ç”»æ’åº:</p> <div class="language- extra-class"><pre><code>Select * From TableName Order By CustomerName Collate Chinese_PRC_Stroke_ci_as //ä»å°‘åˆ°å¤š
</code></pre></div><p>2.æ•°æ®åº“åŠ å¯†:</p> <div class="language- extra-class"><pre><code>select encrypt('åŸå§‹å¯†ç ')
select pwdencrypt('åŸå§‹å¯†ç ')
select pwdcompare('åŸå§‹å¯†ç ','åŠ å¯†åå¯†ç ') = 1--ç›¸åŒï¼›å¦åˆ™ä¸ç›¸åŒ encrypt('åŸå§‹å¯†ç ')
select pwdencrypt('åŸå§‹å¯†ç ')
select pwdcompare('åŸå§‹å¯†ç ','åŠ å¯†åå¯†ç ') = 1--ç›¸åŒï¼›å¦åˆ™ä¸ç›¸åŒ
</code></pre></div><p>3.å–å›è¡¨ä¸­å­—æ®µ:</p> <div class="language- extra-class"><pre><code>declare @list varchar(1000),
@sql nvarchar(1000)
select @list=@list+','+b.name from sysobjects a,syscolumns b where a.id=b.id and a.name='è¡¨A'
set @sql='select '+right(@list,len(@list)-1)+' from è¡¨A'
exec (@sql)
</code></pre></div><p>4.æŸ¥çœ‹ç¡¬ç›˜åˆ†åŒº:</p> <div class="language- extra-class"><pre><code>EXEC master..xp_fixeddrives
</code></pre></div><p>5.æ¯”è¾ƒA,Bè¡¨æ˜¯å¦ç›¸ç­‰:</p> <div class="language- extra-class"><pre><code>if (select checksum_agg(binary_checksum(*)) from A)
     =
    (select checksum_agg(binary_checksum(*)) from B)
print 'ç›¸ç­‰'
else
print 'ä¸ç›¸ç­‰'
</code></pre></div><p>6.æ€æ‰æ‰€æœ‰çš„äº‹ä»¶æ¢å¯Ÿå™¨è¿›ç¨‹:</p> <div class="language- extra-class"><pre><code>DECLARE hcforeach CURSOR GLOBAL FOR SELECT 'kill '+RTRIM(spid) FROM master.dbo.sysprocesses
WHERE program_name IN('SQL profiler',N'SQL äº‹ä»¶æ¢æŸ¥å™¨')
EXEC sp_msforeach_worker '?'
</code></pre></div><p>7.è®°å½•æœç´¢:</p> <div class="language- extra-class"><pre><code>å¼€å¤´åˆ°Næ¡è®°å½•
Select Top N * From è¡¨
-------------------------------
Nåˆ°Mæ¡è®°å½•(è¦æœ‰ä¸»ç´¢å¼•ID)
Select Top M-N * From è¡¨ Where ID in (Select Top M ID From è¡¨) Order by ID   Desc
----------------------------------
Nåˆ°ç»“å°¾è®°å½•
Select Top N * From è¡¨ Order by ID Desc
</code></pre></div><p>æ¡ˆä¾‹
ä¾‹å¦‚1ï¼šä¸€å¼ è¡¨æœ‰ä¸€ä¸‡å¤šæ¡è®°å½•ï¼Œè¡¨çš„ç¬¬ä¸€ä¸ªå­—æ®µ RecID æ˜¯è‡ªå¢é•¿å­—æ®µï¼Œ å†™ä¸€ä¸ªSQLè¯­å¥ï¼Œæ‰¾å‡ºè¡¨çš„ç¬¬31åˆ°ç¬¬40ä¸ªè®°å½•ã€‚</p> <div class="language- extra-class"><pre><code>select top 10 recid from A where recid not  in(select top 30 recid from A)
</code></pre></div><p>åˆ†æï¼šå¦‚æœè¿™æ ·å†™ä¼šäº§ç”ŸæŸäº›é—®é¢˜ï¼Œå¦‚æœrecidåœ¨è¡¨ä¸­å­˜åœ¨é€»è¾‘ç´¢å¼•ã€‚
select top 10 recid from A whereâ€¦â€¦æ˜¯ä»ç´¢å¼•ä¸­æŸ¥æ‰¾ï¼Œè€Œåé¢çš„select top 30 recid from Aåˆ™åœ¨æ•°æ®è¡¨ä¸­æŸ¥æ‰¾ï¼Œè¿™æ ·ç”±äºç´¢å¼•ä¸­çš„é¡ºåºæœ‰å¯èƒ½å’Œæ•°æ®è¡¨ä¸­çš„ä¸ä¸€è‡´ï¼Œè¿™æ ·å°±å¯¼è‡´æŸ¥è¯¢åˆ°çš„ä¸æ˜¯æœ¬æ¥çš„æ¬²å¾—åˆ°çš„æ•°æ®ã€‚
è§£å†³æ–¹æ¡ˆ
1ï¼Œ** ç”¨order by select top 30 recid from A order by ricid å¦‚æœè¯¥å­—æ®µä¸æ˜¯è‡ªå¢é•¿ï¼Œå°±ä¼šå‡ºç°é—®é¢˜**
2ï¼Œ <strong>åœ¨é‚£ä¸ªå­æŸ¥è¯¢ä¸­ä¹ŸåŠ æ¡ä»¶ï¼šselect top 30 recid from A where recid&gt;-1</strong>
ä¾‹2ï¼šæŸ¥è¯¢è¡¨ä¸­çš„æœ€åä»¥æ¡è®°å½•ï¼Œå¹¶ä¸çŸ¥é“è¿™ä¸ªè¡¨å…±æœ‰å¤šå°‘æ•°æ®,ä»¥åŠè¡¨ç»“æ„ã€‚</p> <div class="language- extra-class"><pre><code>    set @s = 'select top 1 * from T   where pid not in (select top ' + str(@count-1) + ' pid  from  T)'

print @s      exec  sp_executesql  @s
</code></pre></div><p>9ï¼šè·å–å½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰ç”¨æˆ·è¡¨</p> <div class="language- extra-class"><pre><code>select Name from sysobjects where xtype='u' and status&gt;=0
</code></pre></div><p>10ï¼šè·å–æŸä¸€ä¸ªè¡¨çš„æ‰€æœ‰å­—æ®µ</p> <div class="language- extra-class"><pre><code>select name from syscolumns where id=object_id('è¡¨å')
select name from syscolumns where id in (select id from sysobjects where type = 'u' and name = 'è¡¨å')
</code></pre></div><p>ä¸¤ç§æ–¹å¼çš„æ•ˆæœç›¸åŒ
11ï¼šæŸ¥çœ‹ä¸æŸä¸€ä¸ªè¡¨ç›¸å…³çš„è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°</p> <div class="language- extra-class"><pre><code>select a.* from sysobjects a, syscomments b where a.id = b.id and b.text like '%è¡¨å%'
</code></pre></div><p>12ï¼šæŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰å­˜å‚¨è¿‡ç¨‹</p> <div class="language- extra-class"><pre><code>select name as å­˜å‚¨è¿‡ç¨‹åç§° from sysobjects where xtype='P'
</code></pre></div><p>13ï¼šæŸ¥è¯¢ç”¨æˆ·åˆ›å»ºçš„æ‰€æœ‰æ•°æ®åº“</p> <div class="language- extra-class"><pre><code>select * from master..sysdatabases D where sid not in(select sid from master..syslogins where name='sa')
</code></pre></div><p>æˆ–è€…</p> <div class="language- extra-class"><pre><code>select dbid, name AS DB_NAME from master..sysdatabases where sid &lt;&gt; 0x01
</code></pre></div><p>14ï¼šæŸ¥è¯¢æŸä¸€ä¸ªè¡¨çš„å­—æ®µå’Œæ•°æ®ç±»å‹</p> <div class="language- extra-class"><pre><code>select column_name,data_type from information_schema.columns
where table_name = 'è¡¨å'
</code></pre></div><p>15ï¼šä¸åŒæœåŠ¡å™¨æ•°æ®åº“ä¹‹é—´çš„æ•°æ®æ“ä½œ
--åˆ›å»ºé“¾æ¥æœåŠ¡å™¨</p> <div class="language- extra-class"><pre><code>exec sp_addlinkedserver   'ITSV ', ' ', 'SQLOLEDB ', 'è¿œç¨‹æœåŠ¡å™¨åæˆ–ipåœ°å€ '
exec sp_addlinkedsrvlogin  'ITSV ', 'false ',null, 'ç”¨æˆ·å ', 'å¯†ç  '
</code></pre></div><p>--æŸ¥è¯¢ç¤ºä¾‹</p> <div class="language- extra-class"><pre><code>select * from ITSV.æ•°æ®åº“å.dbo.è¡¨å
</code></pre></div><p>--å¯¼å…¥ç¤ºä¾‹</p> <div class="language- extra-class"><pre><code>select * into è¡¨ from ITSV.æ•°æ®åº“å.dbo.è¡¨å
</code></pre></div><p>--ä»¥åä¸å†ä½¿ç”¨æ—¶åˆ é™¤é“¾æ¥æœåŠ¡å™¨</p> <div class="language- extra-class"><pre><code>exec sp_dropserver  'ITSV ', 'droplogins '
</code></pre></div><p>--è¿æ¥è¿œç¨‹/å±€åŸŸç½‘æ•°æ®(openrowset/openquery/opendatasource)
--1ã€openrowset
--æŸ¥è¯¢ç¤ºä¾‹</p> <div class="language- extra-class"><pre><code>select * from openrowset( 'SQLOLEDB ', 'sqlæœåŠ¡å™¨å '; 'ç”¨æˆ·å '; 'å¯†ç  ',æ•°æ®åº“å.dbo.è¡¨å)
</code></pre></div><p>--ç”Ÿæˆæœ¬åœ°è¡¨</p> <div class="language- extra-class"><pre><code>select * into è¡¨ from openrowset( 'SQLOLEDB ', 'sqlæœåŠ¡å™¨å '; 'ç”¨æˆ·å '; 'å¯†ç  ',æ•°æ®åº“å.dbo.è¡¨å)
</code></pre></div><p>--æŠŠæœ¬åœ°è¡¨å¯¼å…¥è¿œç¨‹è¡¨</p> <div class="language- extra-class"><pre><code>insert openrowset( 'SQLOLEDB ', 'sqlæœåŠ¡å™¨å '; 'ç”¨æˆ·å '; 'å¯†ç  ',æ•°æ®åº“å.dbo.è¡¨å)
select *from æœ¬åœ°è¡¨
</code></pre></div><p>--æ›´æ–°æœ¬åœ°è¡¨</p> <div class="language- extra-class"><pre><code>update b
set b.åˆ—A=a.åˆ—A
 from openrowset( 'SQLOLEDB ', 'sqlæœåŠ¡å™¨å '; 'ç”¨æˆ·å '; 'å¯†ç  ',æ•°æ®åº“å.dbo.è¡¨å)as a inner join æœ¬åœ°è¡¨ b
on a.column1=b.column1
</code></pre></div><p>--openqueryç”¨æ³•éœ€è¦åˆ›å»ºä¸€ä¸ªè¿æ¥
--é¦–å…ˆåˆ›å»ºä¸€ä¸ªè¿æ¥åˆ›å»ºé“¾æ¥æœåŠ¡å™¨</p> <div class="language- extra-class"><pre><code>exec sp_addlinkedserver   'ITSV ', ' ', 'SQLOLEDB ', 'è¿œç¨‹æœåŠ¡å™¨åæˆ–ipåœ°å€ '
</code></pre></div><p>--æŸ¥è¯¢</p> <div class="language- extra-class"><pre><code>select *
FROM openquery(ITSV,  'SELECT *  FROM æ•°æ®åº“.dbo.è¡¨å ')
</code></pre></div><p>--æŠŠæœ¬åœ°è¡¨å¯¼å…¥è¿œç¨‹è¡¨</p> <div class="language- extra-class"><pre><code>insert openquery(ITSV,  'SELECT *  FROM æ•°æ®åº“.dbo.è¡¨å ')
select * from æœ¬åœ°è¡¨
</code></pre></div><p>--æ›´æ–°æœ¬åœ°è¡¨</p> <div class="language- extra-class"><pre><code>update b
set b.åˆ—B=a.åˆ—B
FROM openquery(ITSV,  'SELECT * FROM æ•°æ®åº“.dbo.è¡¨å ') as a 
inner join æœ¬åœ°è¡¨ b on a.åˆ—A=b.åˆ—A
</code></pre></div><p>--3ã€opendatasource/openrowset</p> <div class="language- extra-class"><pre><code>SELECT   *
FROM   opendatasource( 'SQLOLEDB ',  'Data Source=ip/ServerName;User ID=ç™»é™†å;Password=å¯†ç  ' ).test.dbo.roy_ta
</code></pre></div><p>--æŠŠæœ¬åœ°è¡¨å¯¼å…¥è¿œç¨‹è¡¨</p> <div class="language- extra-class"><pre><code>insert opendatasource( 'SQLOLEDB ',  'Data Source=ip/ServerName;User ID=ç™»é™†å;Password=å¯†ç  ').æ•°æ®åº“.dbo.è¡¨å
select * from æœ¬åœ°è¡¨ 
</code></pre></div><p>SQL ServeråŸºæœ¬å‡½æ•°
1.å­—ç¬¦ä¸²å‡½æ•° é•¿åº¦ä¸åˆ†æç”¨
1,datalength(Char_expr) è¿”å›å­—ç¬¦ä¸²åŒ…å«å­—ç¬¦æ•°,ä½†ä¸åŒ…å«åé¢çš„ç©ºæ ¼
2,substring(expression,start,length) å–å­ä¸²ï¼Œå­—ç¬¦ä¸²çš„ä¸‹æ ‡æ˜¯ä»â€œ1â€ï¼Œstartä¸ºèµ·å§‹ä½ç½®ï¼Œlengthä¸ºå­—ç¬¦ä¸²é•¿åº¦ï¼Œå®é™…åº”ç”¨ä¸­ä»¥len(expression)å–å¾—å…¶é•¿åº¦
3,right(char_expr,int_expr) è¿”å›å­—ç¬¦ä¸²å³è¾¹ç¬¬int_exprä¸ªå­—ç¬¦ï¼Œè¿˜ç”¨leftäºä¹‹ç›¸å
4,isnull( check_expression , replacement_value )å¦‚æœcheck_expressionç‚ºç©ºï¼Œå‰‡è¿”å›replacement_valueçš„å€¼ï¼Œä¸ç‚ºç©ºï¼Œå°±è¿”å›check_expressionå­—ç¬¦æ“ä½œç±»
5,Sp_addtype è‡ªå®šç¾©æ•¸æ“šé¡å‹
ä¾‹å¦‚ï¼šEXEC sp_addtype birthday, datetime, 'NULL'
6,set nocount {on|off}
ä½¿è¿”å›çš„ç»“æœä¸­ä¸åŒ…å«æœ‰å…³å— Transact-SQL è¯­å¥å½±å“çš„è¡Œæ•°çš„ä¿¡æ¯ã€‚å¦‚æœå­˜å‚¨è¿‡ç¨‹ä¸­åŒ…å«çš„ä¸€äº›è¯­å¥å¹¶ä¸è¿”å›è®¸å¤šå®é™…çš„æ•°æ®ï¼Œåˆ™è¯¥è®¾ç½®ç”±äºå¤§é‡å‡å°‘äº†ç½‘ç»œæµé‡ï¼Œå› æ­¤å¯æ˜¾è‘—æé«˜æ€§èƒ½ã€‚SET NOCOUNT è®¾ç½®æ˜¯åœ¨æ‰§è¡Œæˆ–è¿è¡Œæ—¶è®¾ç½®ï¼Œè€Œä¸æ˜¯åœ¨åˆ†ææ—¶è®¾ç½®ã€‚
SET NOCOUNT ä¸º ON æ—¶ï¼Œä¸è¿”å›è®¡æ•°ï¼ˆè¡¨ç¤ºå— Transact-SQL è¯­å¥å½±å“çš„è¡Œæ•°ï¼‰ã€‚
SET NOCOUNT ä¸º OFF æ—¶ï¼Œè¿”å›è®¡æ•°
å¸¸è¯†
åœ¨SQLæŸ¥è¯¢ä¸­ï¼šfromåæœ€å¤šå¯ä»¥è·Ÿå¤šå°‘å¼ è¡¨æˆ–è§†å›¾ï¼š256
åœ¨SQLè¯­å¥ä¸­å‡ºç° Order by,æŸ¥è¯¢æ—¶ï¼Œå…ˆæ’åºï¼Œåå–
åœ¨SQLä¸­ï¼Œä¸€ä¸ªå­—æ®µçš„æœ€å¤§å®¹é‡æ˜¯8000ï¼Œè€Œå¯¹äºnvarchar(4000),ç”±äºnvarcharæ˜¯Unicodeç ã€‚
SQLServer2000åŒæ­¥å¤åˆ¶æŠ€æœ¯å®ç°æ­¥éª¤
ä¸€ã€ é¢„å¤‡å·¥ä½œ
1.å‘å¸ƒæœåŠ¡å™¨,è®¢é˜…æœåŠ¡å™¨éƒ½åˆ›å»ºä¸€ä¸ªåŒåçš„windowsç”¨æˆ·,å¹¶è®¾ç½®ç›¸åŒçš„å¯†ç ,åšä¸ºå‘å¸ƒå¿«ç…§æ–‡ä»¶å¤¹çš„æœ‰æ•ˆè®¿é—®ç”¨æˆ·
--ç®¡ç†å·¥å…·
--è®¡ç®—æœºç®¡ç†
--ç”¨æˆ·å’Œç»„
--å³é”®ç”¨æˆ·
--æ–°å»ºç”¨æˆ·
--å»ºç«‹ä¸€ä¸ªéš¶å±äºadministratorç»„çš„ç™»é™†windowsçš„ç”¨æˆ·ï¼ˆSynUserï¼‰
2.åœ¨å‘å¸ƒæœåŠ¡å™¨ä¸Š,æ–°å»ºä¸€ä¸ªå…±äº«ç›®å½•,åšä¸ºå‘å¸ƒçš„å¿«ç…§æ–‡ä»¶çš„å­˜æ”¾ç›®å½•,æ“ä½œ:
æˆ‘çš„ç”µè„‘--D:\ æ–°å»ºä¸€ä¸ªç›®å½•,åä¸º: PUB
--å³é”®è¿™ä¸ªæ–°å»ºçš„ç›®å½•
--å±æ€§--å…±äº«
--é€‰æ‹©&quot;å…±äº«è¯¥æ–‡ä»¶å¤¹&quot;
--é€šè¿‡&quot;æƒé™&quot;æŒ‰çº½æ¥è®¾ç½®å…·ä½“çš„ç”¨æˆ·æƒé™,ä¿è¯ç¬¬ä¸€æ­¥ä¸­åˆ›å»ºçš„ç”¨æˆ·(SynUser) å…·æœ‰å¯¹è¯¥æ–‡ä»¶å¤¹çš„æ‰€æœ‰æƒé™
--ç¡®å®š
3.è®¾ç½®SQLä»£ç†(SQLSERVERAGENT)æœåŠ¡çš„å¯åŠ¨ç”¨æˆ·(å‘å¸ƒ/è®¢é˜…æœåŠ¡å™¨å‡åšæ­¤è®¾ç½®)
å¼€å§‹--ç¨‹åº--ç®¡ç†å·¥å…·--æœåŠ¡
--å³é”®SQLSERVERAGENT
--å±æ€§--ç™»é™†--é€‰æ‹©&quot;æ­¤è´¦æˆ·&quot;
--è¾“å…¥æˆ–è€…é€‰æ‹©ç¬¬ä¸€æ­¥ä¸­åˆ›å»ºçš„windowsç™»å½•ç”¨æˆ·åï¼ˆSynUserï¼‰
--&quot;å¯†ç &quot;ä¸­è¾“å…¥è¯¥ç”¨æˆ·çš„å¯†ç 
4.è®¾ç½®SQL Serverèº«ä»½éªŒè¯æ¨¡å¼,è§£å†³è¿æ¥æ—¶çš„æƒé™é—®é¢˜(å‘å¸ƒ/è®¢é˜…æœåŠ¡å™¨å‡åšæ­¤è®¾ç½®)
ä¼ä¸šç®¡ç†å™¨
--å³é”®SQLå®ä¾‹--å±æ€§
--å®‰å…¨æ€§--èº«ä»½éªŒè¯
--é€‰æ‹©&quot;SQL Server å’Œ Windows&quot;
--ç¡®å®š
5.åœ¨å‘å¸ƒæœåŠ¡å™¨å’Œè®¢é˜…æœåŠ¡å™¨ä¸Šäº’ç›¸æ³¨å†Œ
ä¼ä¸šç®¡ç†å™¨
--å³é”®SQL Serverç»„
--æ–°å»ºSQL Serveræ³¨å†Œ...
--ä¸‹ä¸€æ­¥--å¯ç”¨çš„æœåŠ¡å™¨ä¸­,è¾“å…¥ä½ è¦æ³¨å†Œçš„è¿œç¨‹æœåŠ¡å™¨å --æ·»åŠ 
--ä¸‹ä¸€æ­¥--è¿æ¥ä½¿ç”¨,é€‰æ‹©ç¬¬äºŒä¸ª&quot;SQL Serverèº«ä»½éªŒè¯&quot;
--ä¸‹ä¸€æ­¥--è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼ˆSynUserï¼‰
--ä¸‹ä¸€æ­¥--é€‰æ‹©SQL Serverç»„,ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°ç»„
--ä¸‹ä¸€æ­¥--å®Œæˆ
6.å¯¹äºåªèƒ½ç”¨IP,ä¸èƒ½ç”¨è®¡ç®—æœºåçš„,ä¸ºå…¶æ³¨å†ŒæœåŠ¡å™¨åˆ«åï¼ˆæ­¤æ­¥åœ¨å®æ–½ä¸­æ²¡ç”¨åˆ°ï¼‰
(åœ¨è¿æ¥ç«¯é…ç½®,æ¯”å¦‚,åœ¨è®¢é˜…æœåŠ¡å™¨ä¸Šé…ç½®çš„è¯,æœåŠ¡å™¨åç§°ä¸­è¾“å…¥çš„æ˜¯å‘å¸ƒæœåŠ¡å™¨çš„IP)
å¼€å§‹--ç¨‹åº--Microsoft SQL Server--å®¢æˆ·ç«¯ç½‘ç»œå®ç”¨å·¥å…·
--åˆ«å--æ·»åŠ 
--ç½‘ç»œåº“é€‰æ‹©&quot;tcp/ip&quot;--æœåŠ¡å™¨åˆ«åè¾“å…¥SQLæœåŠ¡å™¨å
--è¿æ¥å‚æ•°--æœåŠ¡å™¨åç§°ä¸­è¾“å…¥SQLæœåŠ¡å™¨ipåœ°å€
--å¦‚æœä½ ä¿®æ”¹äº†SQLçš„ç«¯å£,å–æ¶ˆé€‰æ‹©&quot;åŠ¨æ€å†³å®šç«¯å£&quot;,å¹¶è¾“å…¥å¯¹åº”çš„ç«¯å£å·
äºŒã€ æ­£å¼é…ç½®
1ã€é…ç½®å‘å¸ƒæœåŠ¡å™¨
æ‰“å¼€ä¼ä¸šç®¡ç†å™¨ï¼Œåœ¨å‘å¸ƒæœåŠ¡å™¨ï¼ˆBã€Cã€Dï¼‰ä¸Šæ‰§è¡Œä»¥ä¸‹æ­¥éª¤:
(1) ä»[å·¥å…·]ä¸‹æ‹‰èœå•çš„[å¤åˆ¶]å­èœå•ä¸­é€‰æ‹©[é…ç½®å‘å¸ƒã€è®¢é˜…æœåŠ¡å™¨å’Œåˆ†å‘]å‡ºç°é…ç½®å‘å¸ƒå’Œåˆ†å‘å‘å¯¼
(2) [ä¸‹ä¸€æ­¥] é€‰æ‹©åˆ†å‘æœåŠ¡å™¨ å¯ä»¥é€‰æ‹©æŠŠå‘å¸ƒæœåŠ¡å™¨è‡ªå·±ä½œä¸ºåˆ†å‘æœåŠ¡å™¨æˆ–è€…å…¶ä»–sqlçš„æœåŠ¡å™¨ï¼ˆé€‰æ‹©è‡ªå·±ï¼‰
(3) [ä¸‹ä¸€æ­¥] è®¾ç½®å¿«ç…§æ–‡ä»¶å¤¹
é‡‡ç”¨é»˜è®¤\servername\Pub
(4) [ä¸‹ä¸€æ­¥] è‡ªå®šä¹‰é…ç½®
å¯ä»¥é€‰æ‹©:æ˜¯,è®©æˆ‘è®¾ç½®åˆ†å‘æ•°æ®åº“å±æ€§å¯ç”¨å‘å¸ƒæœåŠ¡å™¨æˆ–è®¾ç½®å‘å¸ƒè®¾ç½®
å¦,ä½¿ç”¨ä¸‹åˆ—é»˜è®¤è®¾ç½®ï¼ˆæ¨èï¼‰
(5) [ä¸‹ä¸€æ­¥] è®¾ç½®åˆ†å‘æ•°æ®åº“åç§°å’Œä½ç½® é‡‡ç”¨é»˜è®¤å€¼
(6) [ä¸‹ä¸€æ­¥] å¯ç”¨å‘å¸ƒæœåŠ¡å™¨ é€‰æ‹©ä½œä¸ºå‘å¸ƒçš„æœåŠ¡å™¨
(7) [ä¸‹ä¸€æ­¥] é€‰æ‹©éœ€è¦å‘å¸ƒçš„æ•°æ®åº“å’Œå‘å¸ƒç±»å‹
(8) [ä¸‹ä¸€æ­¥] é€‰æ‹©æ³¨å†Œè®¢é˜…æœåŠ¡å™¨
(9) [ä¸‹ä¸€æ­¥] å®Œæˆé…ç½®
2ã€åˆ›å»ºå‡ºç‰ˆç‰©
å‘å¸ƒæœåŠ¡å™¨Bã€Cã€Dä¸Š
(1)ä»[å·¥å…·]èœå•çš„[å¤åˆ¶]å­èœå•ä¸­é€‰æ‹©[åˆ›å»ºå’Œç®¡ç†å‘å¸ƒ]å‘½ä»¤
(2)é€‰æ‹©è¦åˆ›å»ºå‡ºç‰ˆç‰©çš„æ•°æ®åº“ï¼Œç„¶åå•å‡»[åˆ›å»ºå‘å¸ƒ]
(3)åœ¨[åˆ›å»ºå‘å¸ƒå‘å¯¼]çš„æç¤ºå¯¹è¯æ¡†ä¸­å•å‡»[ä¸‹ä¸€æ­¥]ç³»ç»Ÿå°±ä¼šå¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ã€‚å¯¹è¯æ¡†ä¸Šçš„å†…å®¹æ˜¯å¤åˆ¶çš„ä¸‰ä¸ªç±»å‹ã€‚æˆ‘ä»¬ç°åœ¨é€‰ç¬¬ä¸€ä¸ªä¹Ÿå°±æ˜¯é»˜è®¤çš„å¿«ç…§å‘å¸ƒ(å…¶ä»–ä¸¤ä¸ªå¤§å®¶å¯ä»¥å»çœ‹çœ‹å¸®åŠ©)
(4)å•å‡»[ä¸‹ä¸€æ­¥]ç³»ç»Ÿè¦æ±‚æŒ‡å®šå¯ä»¥è®¢é˜…è¯¥å‘å¸ƒçš„æ•°æ®åº“æœåŠ¡å™¨ç±»å‹,
SQLSERVERå…è®¸åœ¨ä¸åŒçš„æ•°æ®åº“å¦‚ orACLEæˆ–ACCESSä¹‹é—´è¿›è¡Œæ•°æ®å¤åˆ¶ã€‚
ä½†æ˜¯åœ¨è¿™é‡Œæˆ‘ä»¬é€‰æ‹©è¿è¡Œ&quot;SQL SERVER 2000&quot;çš„æ•°æ®åº“æœåŠ¡å™¨
(5)å•å‡»[ä¸‹ä¸€æ­¥]ç³»ç»Ÿå°±å¼¹å‡ºä¸€ä¸ªå®šä¹‰æ–‡ç« çš„å¯¹è¯æ¡†ä¹Ÿå°±æ˜¯é€‰æ‹©è¦å‡ºç‰ˆçš„è¡¨
æ³¨æ„: å¦‚æœå‰é¢é€‰æ‹©äº†äº‹åŠ¡å‘å¸ƒ åˆ™å†è¿™ä¸€æ­¥ä¸­åªèƒ½é€‰æ‹©å¸¦æœ‰ä¸»é”®çš„è¡¨
(6)é€‰æ‹©å‘å¸ƒåç§°å’Œæè¿°
(7)è‡ªå®šä¹‰å‘å¸ƒå±æ€§ å‘å¯¼æä¾›çš„é€‰æ‹©:
æ˜¯ æˆ‘å°†è‡ªå®šä¹‰æ•°æ®ç­›é€‰,å¯ç”¨åŒ¿åè®¢é˜…å’Œæˆ–å…¶ä»–è‡ªå®šä¹‰å±æ€§
å¦ æ ¹æ®æŒ‡å®šæ–¹å¼åˆ›å»ºå‘å¸ƒ ï¼ˆå»ºè®®é‡‡ç”¨è‡ªå®šä¹‰çš„æ–¹å¼ï¼‰
(8)[ä¸‹ä¸€æ­¥] é€‰æ‹©ç­›é€‰å‘å¸ƒçš„æ–¹å¼
(9)[ä¸‹ä¸€æ­¥] å¯ä»¥é€‰æ‹©æ˜¯å¦å…è®¸åŒ¿åè®¢é˜…
1)å¦‚æœé€‰æ‹©ç½²åè®¢é˜…,åˆ™éœ€è¦åœ¨å‘å¸ƒæœåŠ¡å™¨ä¸Šæ·»åŠ è®¢é˜…æœåŠ¡å™¨
æ–¹æ³•: [å·¥å…·]-&gt;[å¤åˆ¶]-&gt;[é…ç½®å‘å¸ƒã€è®¢é˜…æœåŠ¡å™¨å’Œåˆ†å‘çš„å±æ€§]-&gt;[è®¢é˜…æœåŠ¡å™¨] ä¸­æ·»åŠ 
å¦åˆ™åœ¨è®¢é˜…æœåŠ¡å™¨ä¸Šè¯·æ±‚è®¢é˜…æ—¶ä¼šå‡ºç°çš„æç¤º:æ”¹å‘å¸ƒä¸å…è®¸åŒ¿åè®¢é˜…
å¦‚æœä»ç„¶éœ€è¦åŒ¿åè®¢é˜…åˆ™ç”¨ä»¥ä¸‹è§£å†³åŠæ³•
[ä¼ä¸šç®¡ç†å™¨]-&gt;[å¤åˆ¶]-&gt;[å‘å¸ƒå†…å®¹]-&gt;[å±æ€§]-&gt;[è®¢é˜…é€‰é¡¹] é€‰æ‹©å…è®¸åŒ¿åè¯·æ±‚è®¢é˜…
2)å¦‚æœé€‰æ‹©åŒ¿åè®¢é˜…,åˆ™é…ç½®è®¢é˜…æœåŠ¡å™¨æ—¶ä¸ä¼šå‡ºç°ä»¥ä¸Šæç¤º
(10)[ä¸‹ä¸€æ­¥] è®¾ç½®å¿«ç…§ ä»£ç†ç¨‹åºè°ƒåº¦
(11)[ä¸‹ä¸€æ­¥] å®Œæˆé…ç½®
å½“å®Œæˆå‡ºç‰ˆç‰©çš„åˆ›å»ºååˆ›å»ºå‡ºç‰ˆç‰©çš„æ•°æ®åº“ä¹Ÿå°±å˜æˆäº†ä¸€ä¸ªå…±äº«æ•°æ®åº“
æœ‰æ•°æ®
srv1.åº“å..authoræœ‰å­—æ®µ:id,name,phone,
srv2.åº“å..authoræœ‰å­—æ®µ:id,name,telphone,adress
è¦æ±‚ï¼š
srv1.åº“å..authorå¢åŠ è®°å½•åˆ™srv1.åº“å..authorè®°å½•å¢åŠ 
srv1.åº“å..authorçš„phoneå­—æ®µæ›´æ–°ï¼Œåˆ™srv1.åº“å..authorå¯¹åº”å­—æ®µtelphoneæ›´æ–°
--*/
--å¤§è‡´çš„å¤„ç†æ­¥éª¤
--1.åœ¨ srv1 ä¸Šåˆ›å»ºè¿æ¥æœåŠ¡å™¨,ä»¥ä¾¿åœ¨ srv1 ä¸­æ“ä½œ srv2,å®ç°åŒæ­¥
exec sp_addlinkedserver 'srv2','','SQLOLEDB','srv2çš„sqlå®ä¾‹åæˆ–ip'
exec sp_addlinkedsrvlogin 'srv2','false',null,'ç”¨æˆ·å','å¯†ç '
go
--2.åœ¨ srv1 å’Œ srv2 è¿™ä¸¤å°ç”µè„‘ä¸­,å¯åŠ¨ msdtc(åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†æœåŠ¡),å¹¶ä¸”è®¾ç½®ä¸ºè‡ªåŠ¨å¯åŠ¨
ã€‚æˆ‘çš„ç”µè„‘--æ§åˆ¶é¢æ¿--ç®¡ç†å·¥å…·--æœåŠ¡--å³é”® Distributed Transaction Coordinator--å±æ€§--å¯åŠ¨--å¹¶å°†å¯åŠ¨ç±»å‹è®¾ç½®ä¸ºè‡ªåŠ¨å¯åŠ¨
go
--ç„¶ååˆ›å»ºä¸€ä¸ªä½œä¸šå®šæ—¶è°ƒç”¨ä¸Šé¢çš„åŒæ­¥å¤„ç†å­˜å‚¨è¿‡ç¨‹å°±è¡Œäº†
ä¼ä¸šç®¡ç†å™¨
--ç®¡ç†
--SQL Serverä»£ç†
--å³é”®ä½œä¸š
--æ–°å»ºä½œä¸š
--&quot;å¸¸è§„&quot;é¡¹ä¸­è¾“å…¥ä½œä¸šåç§°
--&quot;æ­¥éª¤&quot;é¡¹
--æ–°å»º
--&quot;æ­¥éª¤å&quot;ä¸­è¾“å…¥æ­¥éª¤å
--&quot;ç±»å‹&quot;ä¸­é€‰æ‹©&quot;Transact-SQL è„šæœ¬(TSQL)&quot;
--&quot;æ•°æ®åº“&quot;é€‰æ‹©æ‰§è¡Œå‘½ä»¤çš„æ•°æ®åº“
--&quot;å‘½ä»¤&quot;ä¸­è¾“å…¥è¦æ‰§è¡Œçš„è¯­å¥: exec p_process
--ç¡®å®š
--&quot;è°ƒåº¦&quot;é¡¹
--æ–°å»ºè°ƒåº¦
--&quot;åç§°&quot;ä¸­è¾“å…¥è°ƒåº¦åç§°
--&quot;è°ƒåº¦ç±»å‹&quot;ä¸­é€‰æ‹©ä½ çš„ä½œä¸šæ‰§è¡Œå®‰æ’
--å¦‚æœé€‰æ‹©&quot;åå¤å‡ºç°&quot;
--ç‚¹&quot;æ›´æ”¹&quot;æ¥è®¾ç½®ä½ çš„æ—¶é—´å®‰æ’
ç„¶åå°†SQL AgentæœåŠ¡å¯åŠ¨,å¹¶è®¾ç½®ä¸ºè‡ªåŠ¨å¯åŠ¨,å¦åˆ™ä½ çš„ä½œä¸šä¸ä¼šè¢«æ‰§è¡Œ
è®¾ç½®æ–¹æ³•:
æˆ‘çš„ç”µè„‘--æ§åˆ¶é¢æ¿--ç®¡ç†å·¥å…·--æœåŠ¡--å³é”® SQLSERVERAGENT--å±æ€§--å¯åŠ¨ç±»å‹--é€‰æ‹©&quot;è‡ªåŠ¨å¯åŠ¨&quot;--ç¡®å®š.
--3.å®ç°åŒæ­¥å¤„ç†çš„æ–¹æ³•2,å®šæ—¶åŒæ­¥
--åœ¨srv1ä¸­åˆ›å»ºå¦‚ä¸‹çš„åŒæ­¥å¤„ç†å­˜å‚¨è¿‡ç¨‹</p> <div class="language- extra-class"><pre><code>create proc p_process
as
</code></pre></div><p>--æ›´æ–°ä¿®æ”¹è¿‡çš„æ•°æ®</p> <div class="language- extra-class"><pre><code>update b set name=i.name,telphone=i.telphone
from srv2.åº“å.dbo.author b,author i
where b.id=i.id and
(b.name &lt;&gt; i.name or b.telphone &lt;&gt; i.telphone)
</code></pre></div><p>--æ’å…¥æ–°å¢çš„æ•°æ®</p> <div class="language- extra-class"><pre><code>insert srv2.åº“å.dbo.author(id,name,telphone)
select id,name,telphone from author i
where not exists(
select * from srv2.åº“å.dbo.author where id=i.id)
</code></pre></div><p>--åˆ é™¤å·²ç»åˆ é™¤çš„æ•°æ®(å¦‚æœéœ€è¦çš„è¯)</p> <div class="language- extra-class"><pre><code>delete b
from srv2.åº“å.dbo.author b
where not exists(
select * from author where id=b.id)
go
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/zh/resource/server.html">
        ElasticSearch
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.5ba1fee4.js" defer></script><script src="/assets/js/3.2a10d64a.js" defer></script><script src="/assets/js/21.41a6462b.js" defer></script>
  </body>
</html>
